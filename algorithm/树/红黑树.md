## 红黑树

红黑树，Red-Black Tree 「RBT」是一个自平衡(不是绝对的平衡)的二叉查找树(BST)，树上的每个节点都遵循下面的规则:

1. 每个节点都有红色或黑色
2. 树的根始终是黑色的 (黑土地孕育黑树根， )
3. 没有两个相邻的红色节点（红色节点不能有红色父节点或红色子节点，**并没有说不能出现连续的黑色节点**）
4. 从节点（包括根）到其任何后代NULL节点(叶子结点下方挂的两个空节点，并且认为他们是黑色的)的每条路径都具有相同数量的黑色节点

### 左旋右旋

**左旋转：**

**
**

**逆时针**旋转红黑树的两个节点，使得父节点被自己的右孩子取代，而自己成为自己的左孩子。说起来很怪异，大家看下图：





![img](D:\work\notes\study\assert\left-rolate.jpg)



图中，身为右孩子的Y取代了X的位置，而X变成了自己的左孩子。此为左旋转。





**右旋转：**

**
**

**顺时针**旋转红黑树的两个节点，使得父节点被自己的左孩子取代，而自己成为自己的右孩子。大家看下图：





![img](D:\work\notes\study\assert\right-rolate.jpg)



图中，身为左孩子的Y取代了X的位置，而X变成了自己的右孩子。此为右旋转。



### 红黑树插入

红黑树插入流程图，可能需要打开图片查看



<img src="D:\work\notes\study\assert\rbtree-insert-flow.png" alt="img"  />

整个插入流程大概如下：

1. 将新插入的节点标记为红色
2. 如果 X 是根结点(root)，则标记为黑色
3. 如果 X 的 parent 不是黑色，同时 X 也不是 root:

- 3.1 如果 X 的 uncle (叔叔) 是红色
  - 3.1.1 将 parent 和 uncle 标记为黑色
  - 3.1.2 将 grand parent (祖父) 标记为红色
  - 3.1.3 让 X 节点的颜色与 X 祖父的颜色相同，然后重复步骤 2、3

- 3.2 如果 X 的 uncle (叔叔) 是黑色，我们要分四种情况处理
    - 3.2.1 左左 (P 是 G 的左孩子，并且 X 是 P 的左孩子)，这种情况很简单，想象这是一根绳子，手提起 P 节点，然后变色即可
    - 3.2.2 左右 (P 是 G 的左孩子，并且 X 是 P 的右孩子)，使 X 的父节点 P 被 X 取代，同时父节点 P 成为 X 的左孩子，然后再应用 **左左情况**
    - 3.2.3 右右 (和 3.2.1 镜像过来，恰好相反)，与左左情况一样，想象成一根绳子
    - 3.2.4 右左 (和 3.2.2 镜像过来，恰好相反)，使 X 的父节点 P 被 X 取代，同时父节点 P 成为 X 的右孩子，然后再应用 **右右情况**



### 红黑树删除



红黑树的删除操作也包括两部分工作：一查找目标结点；二删除后自平衡。删除后就得做自平衡处理了。删除了结点后需要找结点来替代删除结点的位置，不然子树跟父辈结点断开了，除非删除结点刚好没子结点，那么就不需要替代

对于二叉树删除结点找替代结点有3种情情景：

- 情景1：若删除结点无子结点，直接删除
- 情景2：若删除结点只有一个子结点，用子结点替换删除结点
- 情景3：若删除结点有两个子结点，用后继结点（大于删除结点的最小结点即右子树的最小值，或者小于删除节点的最大节点即左子树的最大值）替换删除结点

**删除结点被替代后，在不考虑结点的键值的情况下，对于树来说，可以认为删除的是替代结点！**在不看键值对的情况下，下图红黑树最终结果是删除了Q所在位置的结点！

![image-20200911133811143](D:\work\notes\study\assert\image-20200911133811143.png)



红黑树节点的删除就是先通过以上方法删除节点的，在实际删除过程中先找到要删除的节点，然后找到删除节点的替代节点，将替代节点移到删除的节点，并将其颜色设置成删除节点的颜色，如果替代节点的颜色为黑色，则代表红黑树的性质被破坏，需要重新调整。

为了方便描述，先约定下各个节点的命令，如下：

![image-20200911152450968](D:\work\notes\study\assert\image-20200911152450968.png)

下面用流程图描述一下删除过程

![image-20200911152450968](.\红黑树删除流程图.svg)



在当前目录下有对应的代码，其中RBTreeTest是网上找的c++代码，rbtree为零声学院实现的代码，可以对比代码跟着文档流程来了解红黑树。

删除时会根据替代节点是其父节点的左孩子还是右孩子来处理，这两种情况是对称的，都是将所有情况朝替代节点的兄弟节点的外侧字节点为红色的情况进行转换。

